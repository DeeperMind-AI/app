<div class="container-fluid">

    <app-page-title title="Exchange" [breadcrumbItems]="breadCrumbItems"></app-page-title>

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-start">
                        <div class="flex-shrink-0 me-3">
                            <img src="assets/images/users/avatar-1.jpg" alt=""
                                class="avatar-md rounded-circle img-thumbnail">
                        </div>
                        <div class="flex-grow-1 align-self-center">
                            <div class="text-muted">
                                <h5>{{trade.pair}}</h5>
                                <p *ngIf="trade.starts" class="mb-1">Starts: {{trade.starts.toMillis() | date:'yyyy/MM/dd h:mm:ss a'}}</p>
                                <p class="mb-0">Id no: {{trade.tradeUID}}</p>
                            </div>
                        </div>
                        <div class="dropdown" dropdown>
                            <button type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false"><i class="mdi mdi-wallet me-1"></i> <span
                                    class="d-none d-sm-inline-block" dropdownToggle>Wallet Balance <i
                                        class="mdi mdi-chevron-down"></i></span></button>
                            <div class="dropdown-menu dropdown-menu-end dropdown-menu-md" *dropdownMenu>
                                <div class="dropdown-item-text">
                                    <div>
                                        <p class="text-muted mb-2">Available Balance</p>
                                        <h5 class="mb-0">$ 9148.23</h5>
                                    </div>
                                </div>

                                <div class="dropdown-divider"></div>

                                <a class="dropdown-item" href="javascript: void(0);">
                                    BTC : <span class="float-end">1.02356</span>
                                </a>
                                <a class="dropdown-item" href="javascript: void(0);">
                                    ETH : <span class="float-end">0.04121</span>
                                </a>
                                <a class="dropdown-item" href="javascript: void(0);">
                                    LTC : <span class="float-end">0.00356</span>
                                </a>

                                <div class="dropdown-divider"></div>

                                <a class="dropdown-item text-primary text-center" href="javascript: void(0);">
                                    Learn more
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xl-8">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title mb-4">Price</h4>

                    <div class="row">
                        <div class="col-xl-3 col-sm-4">
                            <div class="d-flex">
                                <div class="flex-shrink-0 me-3">
                                    <div class="avatar-sm">
                                        <span class="avatar-title rounded-circle bg-soft bg-warning text-warning font-size-22">
                                            <i class="mdi mdi-bitcoin"></i>
                                        </span>
                                    </div>
                                </div>

                                <div class="media-body">
                                    <p class="text-muted mb-2">{{trade.pair}}</p>
                                    <h5>{{trade.latestPrice}} $</h5>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-sm-4">
                            <div class="mt-4 mt-sm-0">
                                <p class="text-muted mb-2">In USD</p>
                                <h5>6310.22 USD</h5>
                            </div>
                        </div>

                        <div class="col-xl-3 col-sm-4">
                            <div class="mt-4 mt-sm-0">
                                <p class="text-muted mb-2">Last 24 hrs</p>
                                <h5>0.24 % <i class="mdi mdi-arrow-up text-success"></i></h5>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <div id="candlestick-chart" class="apex-charts" dir="ltr"></div>
                        <apx-chart class="apex-charts" dir="ltr" [series]="priceCandlestickChart.series"
                            [chart]="priceCandlestickChart.chart" [plotOptions]="priceCandlestickChart.plotOptions"
                            [yaxis]="priceCandlestickChart.yaxis" [xaxis]="priceCandlestickChart.xaxis">
                        </apx-chart>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-4">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title mb-4">Paramètres</h4>

                    <!--<div>
                        <p class="text-muted mb-2"><i class="mdi mdi-wallet me-1"></i> Wallet Balance</p>
                        <h5>$ 9148.23</h5>
                    </div>-->   

                    <!--
                    
                    tradingPair = snap.data().pair;
                    tradingAmount = snap.data().tradingAmount;
                    interval = snap.data().interval; // Intervalle pour les chandeliers
                    smaPeriod = snap.data().smaPeriod; // Période pour la moyenne mobile
                    rsiPeriod = snap.data().rsiPeriod; // Période pour le RSI
                    baseTrailingStopPercent = snap.data().baseTrailingStopPercent; // Trailing stop-loss de base en pourcentage
                    trailingStopPercentBigVol =  snap.data().trailingStopPercent; // Trailing stop-loss en pourcentage si volatilité > 100
                    dynamicProfitThreshold = snap.data().dynamicProfitThreshold; // Seuil de profit initial
                    action = snap.data().dynamicProfitThreshold;
                    solde = snap.data().solde;

                    -->


                    <div class="mt-4">
                        <div>
                            <div>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Pair</label>
                                    </div>
                                    <select class="form-select" style="max-width: 90px;"  [(ngModel)]="trade.pair">
                                        <option value="ADAUSDC" selected>ADAUSDC</option>
                                        <option value="PEPEUSDC">PEPEUSDC</option>
                                        <option value="SUIUSDC">SUIUSDC</option>
                                        <option value="SHIBUSDC">SHIBUSDC</option>
                                        <option value="DOGEUSDC">DOGEUSDC</option>
                                        <option value="XRPUSDC">XRPUSDC</option>
                                        <option value="TRXUSDC">TRXUSDC</option>
                                        <option value="RENDERUSDC">RENDERUSDC</option>
                                        <option value="POLUSDC">POLUSDC</option>
                                        <option value="UNIUSDC">UNIUSDC</option>
                                        <option value="DOTUSDC">DOTUSDC</option>
                                        <option value="CLVUSDT">CLVUSDC</option>
                                        <option value="PNUTUSDC">PNUTUSDC</option>
                                        <option value="XAIUSDT">XAIUSDC</option>
                                        <option value="HBARUSDC">HBARUSDC</option>
                                        <option value="ICPUSDC">ICPUSDC</option>
                                        <option value="NEARUSDC">NEARUSDC</option>
                                        <option value="USUALUSDC">USUALUSDC</option>
                                        <option value="USUALUSDC">BONKUSDC</option>
                                        <option value="JUPUSDC">JUPUSDC</option>
                                    </select>
                                </div>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Amount</label>
                                    </div>
                                    <input type="text" class="form-control"  [(ngModel)]="trade.tradingAmount">
                                </div>  
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Intervalle d'actualisation</label>
                                    </div>
                                    <input type="text" class="form-control"  [(ngModel)]="trade.actualizationInterval">
                                </div>  
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Délai avant rachat</label>
                                    </div>
                                    <input type="text" class="form-control"  [(ngModel)]="trade.waitBuyInterval">
                                </div>  
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Période chandeliers</label>
                                    </div>
                                    <select class="form-select" style="max-width: 90px;" [(ngModel)]="trade.interval">
                                        <option value="1m">1m</option>
                                        <option value="5m">5m</option>
                                        <option value="15m">15m</option>
                                        <option value="30m">30m</option>
                                        <option value="1h" selected>1h</option>
                                    </select>
                                </div>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Méthode vente</label>
                                    </div>
                                    <select class="form-select" style="max-width: 90px;"  [(ngModel)]="trade.sellMode">
                                        <option value="RSI" selected>RSI</option>
                                        <option value="PCT">PCT</option>
                                    </select>
                                </div>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Nb jours SMA</label>
                                    </div>
                                    <input type="text" class="form-control" [(ngModel)]="trade.smaPeriod">
                                    <div class="input-group-append">
                                        <label class="input-group-text">%</label>
                                    </div>
                                </div>  
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Nb jours RSI</label>
                                    </div>
                                    <input type="text" class="form-control" [(ngModel)]="trade.rsiPeriod">
                                    <div class="input-group-append">
                                        <label class="input-group-text">%</label>
                                    </div>
                                </div>  
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Limit stoploss</label>
                                    </div>
                                    <input type="text" class="form-control" [(ngModel)]="trade.baseTrailingStopPercent">
                                    <div class="input-group-append">
                                        <label class="input-group-text">%</label>
                                    </div>
                                </div>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Limit stoploss (vol.>100)</label>
                                    </div>
                                    <input type="text" class="form-control" [(ngModel)]="trade.trailingStopPercentBigVol">
                                    <div class="input-group-append">
                                        <label class="input-group-text">%</label>
                                    </div>
                                </div>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text">Limit marge</label>
                                    </div>
                                    <input type="text" class="form-control" [(ngModel)]="trade.dynamicProfitThreshold">
                                    <div class="input-group-append">
                                        <label class="input-group-text">%</label>
                                    </div>
                                </div>

                                

                                
                            </div>

                            <div class="text-center">
                                <button type="button" class="btn btn-success w-md" (click)="updateTrade()">Update</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end row -->

    <div class="row">
        <div class="col-xl-6">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title mb-4">Order book</h4>

                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr  *ngIf="orders">
                                    <th scope="col">Amount</th>
                                    <th scope="col">Total</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Marge $</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let order of orders | async as items; let i = index; let c = count">
                                    <td *ngIf="order.side==='SELL'">{{(items[i-1].starts.toMillis() | date:'yyyy/MM/dd h:mm:ss a')}} - {{(order.starts.toMillis() | date:'yyyy/MM/dd h:mm:ss a')}}</td>
                                    <td *ngIf="order.side==='SELL'">{{items[i-1].price}}</td>
                                    <td *ngIf="order.side==='SELL'">{{order.price}}</td>        
                                    <td *ngIf="order.side==='SELL'" [ngClass]="{'redTxt': (((order.price*trade.tradingAmount) - (items[i-1].price*trade.tradingAmount)) < 0), 'greenTxt' : (((order.price*trade.tradingAmount) - (items[i-1].price*trade.tradingAmount)) > 0) }">{{(order.price*trade.tradingAmount) - (items[i-1].price*trade.tradingAmount)}}</td>
                                    <td *ngIf="(i===c-1) && (order.side==='BUY')">{{(order.starts.toMillis() | date:'yyyy/MM/dd h:mm:ss a')}} -</td>
                                    <td *ngIf="(i===c-1) && (order.side==='BUY')">{{order.price}}</td>
                                    <td *ngIf="(i===c-1) && (order.side==='BUY')"></td>
                                    <td *ngIf="(i===c-1) && (order.side==='BUY')"></td>
                                </tr>
                            </tbody>
                        </table>


                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-6">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title mb-4">Notifications IA</h4>
                    <ngx-simplebar style="height: 310px;">
                        <!--<ul class="verti-timeline list-unstyled">
                            <li class="event-list" *ngFor="let data of notificationData">
                                <div class="event-timeline-dot">
                                    <i class="bx bx-right-arrow-circle font-size-18"></i>
                                </div>
                                <div class="d-flex">
                                    <div class="flex-shrink-0 me-3">
                                        <h5 class="font-size-14">{{data.date}}<i
                                                class="bx bx-right-arrow-alt font-size-16 text-primary align-middle ms-2"></i>
                                        </h5>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div>
                                            {{data.text}}
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>-->
                    </ngx-simplebar>
                </div>
            </div>
        </div>
    </div>
</div>